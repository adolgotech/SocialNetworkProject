angular.module("app",["ngRoute"]),angular.module("app").controller("ApplicationCtrl",["$scope",function(n){n.$on("login",function(t,o){n.currentUser=o})}]),angular.module("app").controller("LoginCtrl",["$scope","UserSvc",function(n,t){n.login=function(o,e){t.login(o,e).then(function(t){n.$emit("login",t.data),n.username=null,n.password=null})}}]),angular.module("app").controller("PostsCtrl",["$scope","PostsSvc",function(n,t){n.addPost=function(){n.postBody&&t.create({username:"taylorxxx",body:n.postBody}).then(function(t){n.postBody=null})},n.$on("ws:new_post",function(t,o){n.$apply(function(){n.posts.unshift(o)})}),t.fetch().then(function(t){n.posts=t.data})}]),angular.module("app").service("PostsSvc",["$http",function(n){this.fetch=function(){return n.get("/api/posts")},this.create=function(t){return n.post("/api/posts",t)}}]),angular.module("app").controller("RegisterCtrl",["$scope","UserSvc",function(n,t){n.register=function(o,e){t.register(o,e).then(function(t){n.$emit("login",t.data),n.username=null,n.password=null})}}]),angular.module("app").config(["$routeProvider",function(n){n.when("/",{controller:"PostsCtrl",templateUrl:"posts.html"}).when("/register",{controller:"RegisterCtrl",templateUrl:"register.html"}).when("/login",{controller:"LoginCtrl",templateUrl:"login.html"})}]),angular.module("app").service("UserSvc",["$http",function(n){var t=this;t.getUser=function(){return n.get("/api/users")},t.login=function(o,e){return n.post("/api/sessions",{username:o,password:e}).then(function(o){return t.token=o.data,n.defaults.headers.common["X-Auth"]=o.data,t.getUser()})},t.register=function(o,e){return n.post("/api/users",{username:o,password:e}).then(function(n){if(201==n.status)return t.login(o,e)})}}]),angular.module("app").run(["$rootScope","$timeout",function(n,t){!function o(){var e="ws://localhost:3000",r=new WebSocket(e);r.onclose=function(n){console.log("WebSocket closed. Reconnecting..."),t(o,1e4)},r.onopen=function(){console.log("WebSocket connected")},r.onmessage=function(t){console.log(t);var o=JSON.parse(t.data);n.$broadcast("ws:"+o.topic,o.data)}}()}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImFwcGxpY2F0aW9uLmN0cmwuanMiLCJsb2dpbi5jdHJsLmpzIiwicG9zdHMuY3RybC5qcyIsInBvc3RzLnN2Yy5qcyIsInJlZ2lzdGVyLmN0cmwuanMiLCJyb3V0ZXMuanMiLCJ1c2VyLnN2Yy5qcyIsIndlYnNvY2tldHMuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImNvbnRyb2xsZXIiLCIkc2NvcGUiLCIkb24iLCJfIiwidXNlciIsImN1cnJlbnRVc2VyIiwiVXNlclN2YyIsImxvZ2luIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsInRoZW4iLCJyZXNwb25zZSIsIiRlbWl0IiwiZGF0YSIsIlBvc3RzU3ZjIiwiYWRkUG9zdCIsInBvc3RCb2R5IiwiY3JlYXRlIiwiYm9keSIsInBvc3QiLCIkYXBwbHkiLCJwb3N0cyIsInVuc2hpZnQiLCJmZXRjaCIsInNlcnZpY2UiLCIkaHR0cCIsInRoaXMiLCJnZXQiLCJyZWdpc3RlciIsImNvbmZpZyIsIiRyb3V0ZVByb3ZpZGVyIiwid2hlbiIsInRlbXBsYXRlVXJsIiwic3ZjIiwiZ2V0VXNlciIsInZhbCIsInRva2VuIiwiZGVmYXVsdHMiLCJoZWFkZXJzIiwiY29tbW9uIiwicmVzIiwic3RhdHVzIiwicnVuIiwiJHJvb3RTY29wZSIsIiR0aW1lb3V0IiwiY29ubmVjdCIsInVybCIsImNvbm5lY3Rpb24iLCJXZWJTb2NrZXQiLCJvbmNsb3NlIiwiZSIsImNvbnNvbGUiLCJsb2ciLCJvbm9wZW4iLCJvbm1lc3NhZ2UiLCJwYXlsb2FkIiwiSlNPTiIsInBhcnNlIiwiJGJyb2FkY2FzdCIsInRvcGljIl0sIm1hcHBpbmdzIjoiQUFBQUEsUUFBQUMsT0FBQSxPQUNBLFlDREFELFFBQUFDLE9BQUEsT0FDQUMsV0FBQSxtQkFBQSxTQUFBLFNBQUFDLEdBQ0FBLEVBQUFDLElBQUEsUUFBQSxTQUFBQyxFQUFBQyxHQUNBSCxFQUFBSSxZQUFBRCxPQ0hBTixRQUFBQyxPQUFBLE9BQ0FDLFdBQUEsYUFBQSxTQUFBLFVBQUEsU0FBQUMsRUFBQUssR0FDQUwsRUFBQU0sTUFBQSxTQUFBQyxFQUFBQyxHQUNBSCxFQUFBQyxNQUFBQyxFQUFBQyxHQUNBQyxLQUFBLFNBQUFDLEdBQ0FWLEVBQUFXLE1BQUEsUUFBQUQsRUFBQUUsTUFDQVosRUFBQU8sU0FBQSxLQUNBUCxFQUFBUSxTQUFBLFdDUEFYLFFBQUFDLE9BQUEsT0FDQUMsV0FBQSxhQUFBLFNBQUEsV0FBQSxTQUFBQyxFQUFBYSxHQUVBYixFQUFBYyxRQUFBLFdBRUFkLEVBQUFlLFVBQ0FGLEVBQUFHLFFBQ0FULFNBQUEsWUFDQVUsS0FBQWpCLEVBQUFlLFdBQ0FOLEtBQUEsU0FBQVMsR0FFQWxCLEVBQUFlLFNBQUEsUUFLQWYsRUFBQUMsSUFBQSxjQUFBLFNBQUFDLEVBQUFnQixHQUNBbEIsRUFBQW1CLE9BQUEsV0FDQW5CLEVBQUFvQixNQUFBQyxRQUFBSCxPQUlBTCxFQUFBUyxRQUNBYixLQUFBLFNBQUFXLEdBQ0FwQixFQUFBb0IsTUFBQUEsRUFBQVIsVUN4QkFmLFFBQUFDLE9BQUEsT0FDQXlCLFFBQUEsWUFBQSxRQUFBLFNBQUFDLEdBQ0FDLEtBQUFILE1BQUEsV0FDQSxNQUFBRSxHQUFBRSxJQUFBLGVBR0FELEtBQUFULE9BQUEsU0FBQUUsR0FDQSxNQUFBTSxHQUFBTixLQUFBLGFBQUFBLE9DUEFyQixRQUFBQyxPQUFBLE9BQ0FDLFdBQUEsZ0JBQUEsU0FBQSxVQUFBLFNBQUFDLEVBQUFLLEdBQ0FMLEVBQUEyQixTQUFBLFNBQUFwQixFQUFBQyxHQUNBSCxFQUFBc0IsU0FBQXBCLEVBQUFDLEdBQ0FDLEtBQUEsU0FBQUMsR0FDQVYsRUFBQVcsTUFBQSxRQUFBRCxFQUFBRSxNQUNBWixFQUFBTyxTQUFBLEtBQ0FQLEVBQUFRLFNBQUEsV0NQQVgsUUFBQUMsT0FBQSxPQUNBOEIsUUFBQSxpQkFBQSxTQUFBQyxHQUNBQSxFQUNBQyxLQUFBLEtBQUEvQixXQUFBLFlBQUFnQyxZQUFBLGVBQ0FELEtBQUEsYUFBQS9CLFdBQUEsZUFBQWdDLFlBQUEsa0JBQ0FELEtBQUEsVUFBQS9CLFdBQUEsWUFBQWdDLFlBQUEsa0JDTEFsQyxRQUFBQyxPQUFBLE9BQ0F5QixRQUFBLFdBQUEsUUFBQSxTQUFBQyxHQUNBLEdBQUFRLEdBQUFQLElBQ0FPLEdBQUFDLFFBQUEsV0FDQSxNQUFBVCxHQUFBRSxJQUFBLGVBR0FNLEVBQUExQixNQUFBLFNBQUFDLEVBQUFDLEdBQ0EsTUFBQWdCLEdBQUFOLEtBQUEsaUJBQ0FYLFNBQUFBLEVBQUFDLFNBQUFBLElBQ0FDLEtBQUEsU0FBQXlCLEdBR0EsTUFGQUYsR0FBQUcsTUFBQUQsRUFBQXRCLEtBQ0FZLEVBQUFZLFNBQUFDLFFBQUFDLE9BQUEsVUFBQUosRUFBQXRCLEtBQ0FvQixFQUFBQyxhQUlBRCxFQUFBTCxTQUFBLFNBQUFwQixFQUFBQyxHQUNBLE1BQUFnQixHQUFBTixLQUFBLGNBQ0FYLFNBQUFBLEVBQUFDLFNBQUFBLElBQ0FDLEtBQUEsU0FBQThCLEdBQ0EsR0FBQSxLQUFBQSxFQUFBQyxPQUVBLE1BQUFSLEdBQUExQixNQUFBQyxFQUFBQyxTQ3ZCQVgsUUFBQUMsT0FBQSxPQUNBMkMsS0FBQSxhQUFBLFdBQUEsU0FBQUMsRUFBQUMsSUFDQSxRQUFBQyxLQUNBLEdBQUFDLEdBQUEsc0JBQ0FDLEVBQUEsR0FBQUMsV0FBQUYsRUFDQUMsR0FBQUUsUUFBQSxTQUFBQyxHQUNBQyxRQUFBQyxJQUFBLHFDQUNBUixFQUFBQyxFQUFBLE1BR0FFLEVBQUFNLE9BQUEsV0FDQUYsUUFBQUMsSUFBQSx3QkFHQUwsRUFBQU8sVUFBQSxTQUFBSixHQUNBQyxRQUFBQyxJQUFBRixFQUNBLElBQUFLLEdBQUFDLEtBQUFDLE1BQUFQLEVBQUFyQyxLQUNBOEIsR0FBQWUsV0FBQSxNQUFBSCxFQUFBSSxNQUFBSixFQUFBMUMiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiYW5ndWxhci5tb2R1bGUoJ2FwcCcsIFtcbiAgJ25nUm91dGUnXG5dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuLmNvbnRyb2xsZXIoJ0FwcGxpY2F0aW9uQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSkge1xuICAkc2NvcGUuJG9uKCdsb2dpbicsIGZ1bmN0aW9uKF8sIHVzZXIpIHtcbiAgICAkc2NvcGUuY3VycmVudFVzZXIgPSB1c2VyO1xuICB9KVxufSlcbiIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuLmNvbnRyb2xsZXIoJ0xvZ2luQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclN2Yyl7XG4gICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuICAgIFVzZXJTdmMubG9naW4odXNlcm5hbWUsIHBhc3N3b3JkKVxuICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICRzY29wZS4kZW1pdCgnbG9naW4nLCByZXNwb25zZS5kYXRhKTtcbiAgICAgICRzY29wZS51c2VybmFtZSA9IG51bGw7XG4gICAgICAkc2NvcGUucGFzc3dvcmQgPSBudWxsO1xuICAgIH0pO1xuICB9XG59KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuLmNvbnRyb2xsZXIoXCJQb3N0c0N0cmxcIiwgZnVuY3Rpb24oJHNjb3BlLCBQb3N0c1N2Yyl7XG4gICAgLy8gdGhpcyBmdW5jdGlvbiBydW5zIHdoZW4gdGhlIFwiQWRkIFBvc3RcIiBidXR0b24gaXMgY2xpY2tlZFxuICAgICRzY29wZS5hZGRQb3N0ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgLy8gb25seSBhZGQgYSBwb3N0IGlmIHRoZXJlIGlzIGEgYm9keVxuICAgICAgICBpZigkc2NvcGUucG9zdEJvZHkpe1xuICAgICAgICAgICAgUG9zdHNTdmMuY3JlYXRlKHtcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogJ3RheWxvcnh4eCcsXG4gICAgICAgICAgICAgICAgYm9keTogJHNjb3BlLnBvc3RCb2R5XG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHBvc3Qpe1xuICAgICAgICAgICAgICAgIC8vICRzY29wZS5wb3N0cy51bnNoaWZ0KHBvc3QuZGF0YSk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnBvc3RCb2R5ID0gbnVsbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgICRzY29wZS4kb24oJ3dzOm5ld19wb3N0JywgZnVuY3Rpb24oXywgcG9zdCkge1xuICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbigpIHtcbiAgICAgICAgJHNjb3BlLnBvc3RzLnVuc2hpZnQocG9zdCk7XG4gICAgICB9KVxuICAgIH0pXG5cbiAgICBQb3N0c1N2Yy5mZXRjaCgpXG4gICAgLnRoZW4oZnVuY3Rpb24ocG9zdHMpe1xuICAgICAgICAkc2NvcGUucG9zdHMgPSBwb3N0cy5kYXRhO1xuICAgIH0pO1xufSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbi5zZXJ2aWNlKCdQb3N0c1N2YycsIGZ1bmN0aW9uKCRodHRwKXtcbiAgdGhpcy5mZXRjaCA9IGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuICRodHRwLmdldChcIi9hcGkvcG9zdHNcIik7XG4gIH07XG5cbiAgdGhpcy5jcmVhdGUgPSBmdW5jdGlvbihwb3N0KXtcbiAgICByZXR1cm4gJGh0dHAucG9zdChcIi9hcGkvcG9zdHNcIiwgcG9zdCk7XG4gIH07XG59KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuLmNvbnRyb2xsZXIoJ1JlZ2lzdGVyQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgVXNlclN2Yykge1xuICAkc2NvcGUucmVnaXN0ZXIgPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpIHtcbiAgICBVc2VyU3ZjLnJlZ2lzdGVyKHVzZXJuYW1lLCBwYXNzd29yZClcbiAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAkc2NvcGUuJGVtaXQoJ2xvZ2luJywgcmVzcG9uc2UuZGF0YSk7XG4gICAgICAkc2NvcGUudXNlcm5hbWUgPSBudWxsO1xuICAgICAgJHNjb3BlLnBhc3N3b3JkID0gbnVsbDtcbiAgICB9KTtcbiAgfVxufSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbi5jb25maWcoZnVuY3Rpb24oJHJvdXRlUHJvdmlkZXIpe1xuICAkcm91dGVQcm92aWRlclxuICAud2hlbignLycsIHsgY29udHJvbGxlcjogJ1Bvc3RzQ3RybCcsIHRlbXBsYXRlVXJsOiAncG9zdHMuaHRtbCcgfSlcbiAgLndoZW4oJy9yZWdpc3RlcicsIHsgY29udHJvbGxlcjogJ1JlZ2lzdGVyQ3RybCcsIHRlbXBsYXRlVXJsOiAncmVnaXN0ZXIuaHRtbCcgfSlcbiAgLndoZW4oJy9sb2dpbicsIHsgY29udHJvbGxlcjogJ0xvZ2luQ3RybCcsIHRlbXBsYXRlVXJsOiAnbG9naW4uaHRtbCcgfSlcbn0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4uc2VydmljZSgnVXNlclN2YycsIGZ1bmN0aW9uKCRodHRwKXtcbiAgdmFyIHN2YyA9IHRoaXM7XG4gIHN2Yy5nZXRVc2VyID0gZnVuY3Rpb24oKXtcbiAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzJyk7XG4gIH1cblxuICBzdmMubG9naW4gPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpe1xuICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3Nlc3Npb25zJywge1xuICAgICAgJ3VzZXJuYW1lJzogdXNlcm5hbWUsICdwYXNzd29yZCc6IHBhc3N3b3JkXG4gICAgfSkudGhlbihmdW5jdGlvbih2YWwpe1xuICAgICAgc3ZjLnRva2VuID0gdmFsLmRhdGE7XG4gICAgICAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnWC1BdXRoJ10gPSB2YWwuZGF0YTtcbiAgICAgIHJldHVybiBzdmMuZ2V0VXNlcigpO1xuICAgIH0pO1xuICB9XG5cbiAgc3ZjLnJlZ2lzdGVyID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XG4gICAgcmV0dXJuICRodHRwLnBvc3QoJy9hcGkvdXNlcnMnLCB7XG4gICAgICAndXNlcm5hbWUnOiB1c2VybmFtZSwgJ3Bhc3N3b3JkJzogcGFzc3dvcmRcbiAgICB9KS50aGVuKGZ1bmN0aW9uKHJlcyl7XG4gICAgICBpZihyZXMuc3RhdHVzID09IDIwMSlcbiAgICAgIHtcbiAgICAgICAgcmV0dXJuIHN2Yy5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuLnJ1bihmdW5jdGlvbiAoJHJvb3RTY29wZSwgJHRpbWVvdXQpIHtcbiAgKGZ1bmN0aW9uIGNvbm5lY3QoKSB7XG4gICAgdmFyIHVybCA9ICd3czovL2xvY2FsaG9zdDozMDAwJztcbiAgICB2YXIgY29ubmVjdGlvbiA9IG5ldyBXZWJTb2NrZXQodXJsKTtcbiAgICBjb25uZWN0aW9uLm9uY2xvc2UgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgY29uc29sZS5sb2coJ1dlYlNvY2tldCBjbG9zZWQuIFJlY29ubmVjdGluZy4uLicpO1xuICAgICAgJHRpbWVvdXQoY29ubmVjdCwgMTAwMDApO1xuICAgIH1cblxuICAgIGNvbm5lY3Rpb24ub25vcGVuID0gZnVuY3Rpb24gKCl7XG4gICAgICBjb25zb2xlLmxvZygnV2ViU29ja2V0IGNvbm5lY3RlZCcpO1xuICAgIH1cblxuICAgIGNvbm5lY3Rpb24ub25tZXNzYWdlID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgICAgdmFyIHBheWxvYWQgPSBKU09OLnBhcnNlKGUuZGF0YSk7XG4gICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3dzOicgKyBwYXlsb2FkLnRvcGljLCBwYXlsb2FkLmRhdGEpO1xuICAgIH1cbiAgfSkoKVxufSlcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
